<!DOCTYPE html>
<html>
<head>
    <title>진료시간 안내</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.4/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.4/plugin/weekday.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.4/plugin/isBetween.js"></script>
</head>
<body>
    <h1 class="main-title">구병원 진료 스케줄</h1>
    <div class="schedule-container">
        <div class="schedule-box" id="am-box">
            <h2>오전 진료</h2>
            <table>
                <thead>
                    <tr>
                        <th>진료과</th>
                        <th>진료의사</th>
                        <th>비고</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="schedule-box" id="pm-box">
            <h2>오후 진료</h2>
            <table>
                <thead>
                    <tr>
                        <th>진료과</th>
                        <th>진료의사</th>
                        <th>비고</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <script>
        dayjs.extend(dayjs_plugin_weekday);
        dayjs.extend(dayjs_plugin_isBetween);

        const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT_Qf58i_Q_h7tDk8t5m-jY2o61T1g7X_F2_o7q4J7u_j7j5u/pub?gid=0&single=true&output=csv";

        const now = dayjs();
        const weekday = now.weekday(); 
        const weekdays = ['일', '월', '화', '수', '목', '금', '토'];
        const todayName = weekdays[weekday];

        function getSheetData() {
            fetch(sheetUrl)
                .then(response => response.text())
                .then(text => {
                    const rows = text.split('\n').slice(1);
                    const amBody = document.querySelector('#am-box tbody');
                    const pmBody = document.querySelector('#pm-box tbody');
                    amBody.innerHTML = '';
                    pmBody.innerHTML = '';

                    rows.forEach(row => {
                        const columns = row.split(',');
                        if (columns.length < 5) return;

                        const day = columns[0].trim();
                        if (day !== todayName) return;

                        const department = columns[1].trim();
                        const doctor = columns[2].trim();
                        const note = columns[3].trim();
                        const schedule = columns[4].trim();

                        const tr = document.createElement('tr');
                        const departmentCell = document.createElement('td');
                        const doctorCell = document.createElement('td');
                        const noteCell = document.createElement('td');

                        departmentCell.textContent = department;
                        doctorCell.textContent = doctor;
                        noteCell.textContent = note;

                        // 특이사항에 따른 클래스 추가
                        if (note.includes('휴진') || note.includes('마감')) {
                            noteCell.classList.add('closed');
                        } else if (note.includes('수술')) {
                            noteCell.classList.add('surgery');
                        } else if (note.includes('종료')) {
                            noteCell.classList.add('finished');
                        }
                        
                        // 진료과에 따른 배경색 클래스 추가
                        if (department.includes('일반외과')) {
                            tr.classList.add('general-surgery');
                        } else if (department.includes('내과')) {
                            tr.classList.add('internal-medicine');
                        } else if (department.includes('갑상선유방센터')) {
                            tr.classList.add('thyroid-breast');
                        } else if (department.includes('신경외과')) {
                            tr.classList.add('neurosurgery');
                        } else if (department.includes('정형외과')) {
                            tr.classList.add('orthopedics');
                        } else if (department.includes('산부인과')) {
                            tr.classList.add('obgyn');
                        }

                        tr.appendChild(departmentCell);
                        tr.appendChild(doctorCell);
                        tr.appendChild(noteCell);

                        if (schedule === '오전') {
                            amBody.appendChild(tr);
                        } else if (schedule === '오후') {
                            pmBody.appendChild(tr);
                        }
                    });
                });
        }
        
        getSheetData();

        // 30초마다 페이지를 새로고침하는 코드
        setInterval(function() {
            location.reload();
        }, 30000);
    </script>
</body>
</html>
