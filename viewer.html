<!DOCTYPE html>
<html>
<head>
    <title>진료시간 안내</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 class="main-title">구병원 진료 스케줄</h1>
    <div class="schedule-container">
        <div class="schedule-box" id="am-schedule">
            <h2>오전 진료</h2>
            <table>
                <thead>
                    <tr>
                        <th>진료과</th>
                        <th>진료의사</th>
                        <th>의사상태</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="schedule-box" id="pm-schedule">
            <h2>오후 진료</h2>
            <table>
                <thead>
                    <tr>
                        <th>진료과</th>
                        <th>진료의사</th>
                        <th>의사상태</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        const sheetId = '1m0kCyq3QI9e203Rkhh0_gTFD6Jdafn89p3-AbddZ2OU'; 
        const dayNames = ['일', '월', '화', '수', '목', '금', '토'];

        const gidMap = {
            '일': '1340551526',
            '월': '166831320',
            '화': '1050890560',
            '수': '675567842',
            '목': '1074220298',
            '금': '1055010041',
            '토': '944320917',
        };

        function fetchSchedule() {
            const today = new Date();
            const currentDayName = dayNames[today.getDay()];
            const currentGid = gidMap[currentDayName];
            
            if (!currentGid) {
                console.error(`Error: Gid for ${currentDayName} not found.`);
                return;
            }

            const apiUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?gid=${currentGid}&tqx=out:json`;
            
            fetch(apiUrl)
                .then(res => res.text())
                .then(text => {
                    const json = JSON.parse(text.substr(47).slice(0, -2));
                    const rows = json.table.rows;
                    
                    const amTableBody = document.querySelector('#am-schedule tbody');
                    const pmTableBody = document.querySelector('#pm-schedule tbody');
                    amTableBody.innerHTML = '';
                    pmTableBody.innerHTML = '';

                    rows.forEach(row => {
                        const ampm = row.c[0] ? row.c[0].v : '';
                        let department = row.c[1] ? row.c[1].v : '';
                        const doctor = row.c[2] ? row.c[2].v : '';
                        const status = row.c[3] ? row.c[3].v : '';

                        if (department.includes(':')) {
                            department = department.split(':')[1].trim();
                        }

                        let departmentClass = '';
                        if (department === '일반외과') {
                            departmentClass = 'general-surgery';
                        } else if (department === '내과') {
                            departmentClass = 'internal-medicine';
                        } else if (department === '갑상선유방센터') {
                            departmentClass = 'thyroid-breast';
                        } else if (department === '신경외과') {
                            departmentClass = 'neurosurgery';
                        } else if (department === '정형외과') {
                            departmentClass = 'orthopedics';
                        } else if (department === '산부인과') {
                            departmentClass = 'obgyn';
                        }
                        
                        let statusClass = '';
                        if (status === '휴진') {
                            statusClass = 'closed';
                        } else if (status === '수술중') {
                            statusClass = 'surgery';
                        }

                        const tr = document.createElement('tr');
                        tr.className = departmentClass;
                        tr.innerHTML = `
                            <td>${department}</td>
                            <td>${doctor}</td>
                            <td class="${statusClass}">${status}</td>
                        `;
                        
                        if (ampm === '오전') {
                            amTableBody.appendChild(tr);
                        } else if (ampm === '오후') {
                            pmTableBody.appendChild(tr);
                        }
                    });
                });
        }

        setInterval(fetchSchedule, 30000);
        fetchSchedule();
    </script>
</body>
</html>
