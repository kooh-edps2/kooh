<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구병원 장례식장</title>
    <style>
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-5Medium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            font-family: 'S-CoreDream', 'Malgun Gothic', '맑은 고딕', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #dee2e6;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            display: grid;
            grid-template-rows: 8% 84% 8%;
            grid-template-columns: 1fr;
            padding: 1vh;
            box-sizing: border-box;
            gap: 1vh;
        }

        .title-box {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 0 3%;
        }
        
        .title-box span {
            font-size: 5vh;
            font-weight: bold;
            color: #2c3e50;
        }

        .main-content {
            display: grid;
            grid-template-rows: 15% 85%;
            grid-template-columns: 1fr;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-row {
            display: grid;
            grid-template-columns: 35% 65%;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-cell {
            background-color: #2c3e50;
            color: #ffffff;
            font-size: 3.5vh;
            text-align: center;
            padding: 1.5vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-cell:nth-child(1) {
            border-right: 2px solid #ffffff;
        }

        .data-row {
            display: grid;
            grid-template-columns: 35% 65%;
            font-size: 3vh;
            text-align: center;
        }
        
        .data-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1vh;
            word-break: break-all;
            white-space: pre-wrap;
            border-right: 2px solid #e0e0e0;
        }

        .data-cell:last-child {
            border-right: none;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 50% 50%;
            background-color: #2c3e50;
            color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .footer-cell {
            font-size: 3.5vh;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .footer-cell:nth-child(1) {
            border-right: 2px solid #ffffff;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="title-box">
            <span id="room-title"></span>
        </div>

        <div class="main-content">
            <div class="header-row">
                <div class="header-cell">고인명</div>
                <div class="header-cell">상주</div>
            </div>
            <div class="data-row">
                <div class="data-cell" id="deceased-name"></div>
                <div class="data-cell" id="mourner-name"></div>
            </div>
        </div>

        <div class="footer-content">
            <div class="footer-cell">발인</div>
            <div class="footer-cell">장지</div>
        </div>
    </div>

    <script>
        // 구글 시트의 ID를 정확하게 입력해주세요.
        const SPREADSHEET_ID = '19O4dLcRh-WXT0hWWFoLhQYhnpReAr0htIShNEUjEEDg';
        // gid=0은 첫 번째 시트 탭을 의미합니다. 다른 탭을 사용한다면 gid 값을 변경하세요.
        const GID = 0;

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const roomNumber = getQueryParam('room');

        function fetchData() {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;

            fetch(sheetUrl)
                .then(response => response.text())
                .then(text => {
                    const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                    const jsonData = JSON.parse(jsonText);
                    
                    const headers = jsonData.table.cols.map(col => col.label);
                    const rows = jsonData.table.rows;
                    
                    const dataRows = [];
                    rows.forEach(row => {
                        const item = {};
                        row.c.forEach((cell, i) => {
                            const header = headers[i];
                            if (header) {
                                item[header] = cell ? (cell.v || cell.f || '') : '';
                            }
                        });
                        const room = item.분향실 ? String(item.분향실).trim() : '';
                        if (room === roomNumber) {
                            dataRows.push(item);
                        }
                    });

                    if (dataRows.length > 0) {
                        const item = dataRows[0];
                        document.getElementById('room-title').textContent = `${item.분향실} 분향실`;
                        document.getElementById('deceased-name').textContent = `故 ${item.고인명}`;
                        document.getElementById('mourner-name').textContent = item.상주;
                        document.getElementById('footer-cell-1').textContent = `발인: ${item['발인/장지'].split(' ')[0]}`;
                        document.getElementById('footer-cell-2').textContent = `장지: ${item['발인/장지'].split(' ')[1]}`;
                    } else {
                        document.getElementById('room-title').textContent = `${roomNumber} 분향실`;
                        document.getElementById('deceased-name').textContent = '정보 없음';
                        document.getElementById('mourner-name').textContent = '정보 없음';
                        document.getElementById('footer-cell-1').textContent = '발인: 정보 없음';
                        document.getElementById('footer-cell-2').textContent = '장지: 정보 없음';
                    }
                })
                .catch(error => {
                    console.error('데이터를 불러오는 중 오류가 발생했습니다:', error);
                    document.getElementById('room-title').textContent = `${roomNumber} 분향실`;
                    document.getElementById('deceased-name').textContent = '데이터 로딩 오류';
                    document.getElementById('mourner-name').textContent = '데이터 로딩 오류';
                    document.getElementById('footer-cell-1').textContent = '발인: 오류';
                    document.getElementById('footer-cell-2').textContent = '장지: 오류';
                });
        }
        
        if (roomNumber) {
            fetchData();
            setInterval(fetchData, 30000);
        } else {
            document.body.innerHTML = '<div style="text-align:center; padding: 20px;">URL에 분향실 번호가 없습니다. 예: funeral.html?room=1</div>';
        }

        // Add IDs to footer cells for easier access
        document.querySelector('.footer-content .footer-cell:nth-child(1)').id = 'footer-cell-1';
        document.querySelector('.footer-content .footer-cell:nth-child(2)').id = 'footer-cell-2';
    </script>
</body>
</html>
