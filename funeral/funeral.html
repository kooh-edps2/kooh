<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구병원 장례식장</title>
    <style>
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-5Medium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            font-family: 'S-CoreDream', 'Malgun Gothic', '맑은 고딕', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #dee2e6;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            display: grid;
            grid-template-rows: 15% 77% 8%; /* 상단 박스와 메인 콘텐츠, 하단 박스 높이 조정 */
            grid-template-columns: 1fr;
            padding: 1vh;
            box-sizing: border-box;
            gap: 1vh;
        }

        .title-box {
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .room-number-box {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 10vh;
            height: 10vh;
            background-color: #2c3e50;
            border-radius: 10px;
            margin-right: 2vh;
        }
        
        .room-number {
            font-size: 6vh;
            font-weight: bold;
            color: #ffffff;
        }

        .room-title {
            font-size: 6vh;
            font-weight: bold;
            color: #2c3e50;
        }

        .main-content {
            display: grid;
            grid-template-rows: 15% 85%;
            grid-template-columns: 1fr;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-row {
            display: grid;
            grid-template-columns: 35% 65%;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-cell {
            background-color: #2c3e50;
            color: #ffffff;
            font-size: 4vh; /* 제목 글자 크기 증가 */
            text-align: center;
            padding: 1vh; /* 제목 박스 크기 축소 */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .header-cell:nth-child(1) {
            border-right: 2px solid #ffffff;
        }

        .data-row {
            display: grid;
            grid-template-columns: 35% 65%;
            text-align: center;
        }
        
        .data-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1vh;
            word-break: break-all;
            white-space: pre-wrap;
            border-right: 2px solid #e0e0e0;
        }

        .data-cell:last-child {
            border-right: none;
        }

        #deceased-name {
            font-size: 6vh; /* 고인명 글자 크기 크게 */
        }

        #mourner-name {
            font-size: 4vh; /* 상주 글자 크기 약간 증가 */
            text-align: left; /* 상주 내용 왼쪽 정렬 */
            justify-content: flex-start;
            padding-left: 3vh;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 20% 30% 20% 30%; /* '발인'과 '장지' 글자용 박스 추가 */
            background-color: #2c3e50;
            color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .footer-label {
            font-size: 3.5vh;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 2px solid #ffffff;
        }

        .footer-data {
            font-size: 3.5vh;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-all;
            white-space: pre-wrap;
            padding: 1vh;
        }
        
        .footer-data:first-of-type {
            border-right: 2px solid #ffffff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title-box">
            <div class="room-number-box">
                <span class="room-number" id="room-number"></span>
            </div>
            <span class="room-title">분향실</span>
        </div>

        <div class="main-content">
            <div class="header-row">
                <div class="header-cell">고인명</div>
                <div class="header-cell">상주</div>
            </div>
            <div class="data-row">
                <div class="data-cell" id="deceased-name"></div>
                <div class="data-cell" id="mourner-name"></div>
            </div>
        </div>

        <div class="footer-content">
            <div class="footer-label">발인</div>
            <div class="footer-data" id="funeral-date"></div>
            <div class="footer-label">장지</div>
            <div class="footer-data" id="burial-place"></div>
        </div>
    </div>

    <script>
        // 구글 시트의 ID를 정확하게 입력해주세요.
        const SPREADSHEET_ID = '19O4dLcRh-WXT0hWWFoLhQYhnpReAr0htIShNEUjEEDg';
        // gid=0은 첫 번째 시트 탭을 의미합니다. 다른 탭을 사용한다면 gid 값을 변경하세요.
        const GID = 0;

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const roomNumber = getQueryParam('room');

        function fetchData() {
            const sheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;

            fetch(sheetUrl)
                .then(response => response.text())
                .then(text => {
                    const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}') + 1);
                    const jsonData = JSON.parse(jsonText);
                    
                    const headers = jsonData.table.cols.map(col => col.label);
                    const rows = jsonData.table.rows;
                    
                    const dataRows = [];
                    rows.forEach(row => {
                        const item = {};
                        row.c.forEach((cell, i) => {
                            const header = headers[i];
                            if (header) {
                                // 셀의 'f' (formatted value) 속성을 사용하여 정확한 값을 가져옴
                                item[header] = cell ? (cell.f || cell.v || '') : '';
                            }
                        });
                        const room = item.분향실 ? String(item.분향실).trim() : '';
                        if (room === roomNumber) {
                            dataRows.push(item);
                        }
                    });

                    if (dataRows.length > 0) {
                        const item = dataRows[0];
                        document.getElementById('room-number').textContent = item.분향실;
                        document.getElementById('deceased-name').textContent = `故 ${item.고인명}`;
                        document.getElementById('mourner-name').textContent = item.상주;
                        document.getElementById('funeral-date').textContent = item.발인;
                        document.getElementById('burial-place').textContent = item.장지;
                    } else {
                        document.getElementById('room-number').textContent = roomNumber;
                        document.getElementById('deceased-name').textContent = '정보 없음';
                        document.getElementById('mourner-name').textContent = '정보 없음';
                        document.getElementById('funeral-date').textContent = '정보 없음';
                        document.getElementById('burial-place').textContent = '정보 없음';
                    }
                })
                .catch(error => {
                    console.error('데이터를 불러오는 중 오류가 발생했습니다:', error);
                    document.getElementById('room-number').textContent = roomNumber;
                    document.getElementById('deceased-name').textContent = '데이터 로딩 오류';
                    document.getElementById('mourner-name').textContent = '데이터 로딩 오류';
                    document.getElementById('funeral-date').textContent = '데이터 로딩 오류';
                    document.getElementById('burial-place').textContent = '데이터 로딩 오류';
                });
        }
        
        if (roomNumber) {
            fetchData();
            setInterval(fetchData, 30000);
        } else {
            document.body.innerHTML = '<div style="text-align:center; padding: 20px;">URL에 분향실 번호가 없습니다. 예: funeral.html?room=1</div>';
        }
    </script>
</body>
</html>
