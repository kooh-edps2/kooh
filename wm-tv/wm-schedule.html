<!DOCTYPE html>
<html>
<head>
    <title>ì§„ë£Œì‹œê°„ ì•ˆë‚´</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @font-face {
            font-family: 'S-CoreDream';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-5Medium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'GmarketSansMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff2') format('woff2'),
                 url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'S-CoreDream', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            font-size: 3vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 0.2vh;
            box-sizing: border-box;
            background-color: #212529;
            color: #f8f9fa;
            height: 100vh;
            overflow: auto;
        }

        .title-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #004c6d; /* ê¹Šê³  ì„ ëª…í•œ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            border: 1px solid #0077a6; /* í…Œë‘ë¦¬ ìƒ‰ìƒë„ í•¨ê»˜ ë³€ê²½ */
            border-radius: 10px;
            margin-top: 0.5vh;
            margin-left: 0.5vh;
            margin-right: 0.5vh;
            margin-bottom: 1vh;
            padding: 0.2vh 1.5vh; /* ìˆ˜ì§ ì—¬ë°±ì„ ì¤„ì—¬ ë¡œê³  ê³µê°„ í™•ë³´ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            width: 98%;
            box-sizing: border-box;
            cursor: pointer; /* í…ŒìŠ¤íŠ¸ ëª¨ë“œ í™œì„±í™”ë¥¼ ìœ„í•´ ì»¤ì„œ ë³€ê²½ */
        }

        .title-group {
            display: flex;
            align-items: center; /* ë¡œê³ ì™€ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
            gap: 1em;
        }

        #logo {
            height: 6vh; /* ë°•ìŠ¤ì— ë§ì¶° ë¡œê³  í¬ê¸° ìµœëŒ€í™” */
        }

        .main-title {
            font-family: 'GmarketSansMedium', sans-serif;
            color: #f8f9fa;
            margin: 0;
            font-size: 5vh;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .current-date {
            font-family: 'S-CoreDream', sans-serif;
            font-size: 2.5vh;
            font-weight: normal;
            color: #ced4da;
            margin: 0; /* p íƒœê·¸ì˜ ê¸°ë³¸ ë§ˆì§„ ì œê±° */
        }

        .schedule-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            flex: 1;
            width: 98%;
            background-color: #2a3641;
            border-radius: 10px;
            padding: 0.2vh;
            box-sizing: border-box;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            overflow: auto;
        }

        .time-slot-box {
            display: flex;
            flex-direction: column;
            border: 1px solid #4a5c6d;
            border-radius: 8px;
            margin: 0.3vh;
            padding: 0.5vh;
            flex: 1 1 45%;
            min-width: 300px;
            position: relative; /* ì˜¤ë²„ë ˆì´ë¥¼ ìœ„í•œ ìœ„ì¹˜ ê¸°ì¤€ ì„¤ì • */
            transition: opacity 0.5s ease, filter 0.5s ease;
        }

        .time-slot-box.am {
            background-color: #242f39;
        }

        .time-slot-box.pm {
            background-color: #242f39;
        }

        .finished-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(52, 58, 64, 0.65); /* ë°˜íˆ¬ëª… íšŒìƒ‰ ì˜¤ë²„ë ˆì´ */
            /* ì‚¬ì„  íŒ¨í„´ ì¶”ê°€ */
            background-image: repeating-linear-gradient(
                -45deg,
                transparent, transparent 15px,
                rgba(0, 0, 0, 0.1) 15px, rgba(0, 0, 0, 0.1) 30px
            );
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            justify-content: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
            align-items: flex-start; /* ì„¸ë¡œ ìƒë‹¨ ì •ë ¬ */
            padding-top: 0.5vh; /* ì œëª© ìœ„ì¹˜ì™€ ë¹„ìŠ·í•˜ê²Œ ìƒë‹¨ ì—¬ë°± ì¶”ê°€ */
            border-radius: 8px;
            z-index: 3; /* ë‹¤ë¥¸ ëª¨ë“  ì˜¤ë²„ë ˆì´ì™€ ë‚´ìš©ì„ ë®ë„ë¡ ìµœìƒìœ„ë¡œ ì„¤ì • */
        }

        .finished-overlay span {
            background-color: #495057; /* í…ìŠ¤íŠ¸ë¥¼ ê°ì‹¸ëŠ” íšŒìƒ‰ ë°•ìŠ¤ ë°°ê²½ */
            color: #f8f9fa; /* ë°ì€ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            padding: 0.1vh 1.5vh; /* ì œëª©ê³¼ ìœ ì‚¬í•˜ê²Œ, ë†’ì´ë¥¼ ì¤„ì„ */
            border-radius: 4px; /* ì œëª©ê³¼ ìœ ì‚¬í•œ ë‘¥ê¸€ê¸° */
            border: 1px solid #6c757d;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5); /* ì…ì²´ê°ì„ ìœ„í•œ ê·¸ë¦¼ì */
            font-size: 4.5vh; /* ì œëª©ê³¼ ìœ ì‚¬í•œ í¬ê¸° */
            font-family: 'GmarketSansMedium', sans-serif;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0,0,0,0.7); /* í…ìŠ¤íŠ¸ ê·¸ë¦¼ì ì¡°ì • */
        }

        .schedule-section-title {
            font-family: 'GmarketSansMedium', sans-serif;
            text-align: center;
            color: #f8f9fa;
            margin: 0 0 0.5vh 0;
            font-size: 4.4vh; /* ì œëª© ê¸€ì í¬ê¸° ë³µì› */
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 3.5vh; /* í…Œì´ë¸” ê¸€ì í¬ê¸° ë³µì› */
            border-spacing: 0;
            table-layout: fixed;
        }

        th, td {
            border: 0;
            padding: 0.1vh 0.5vh; /* í…Œì´ë¸” ì…€ ì—¬ë°± ë³µì› */
            text-align: center;
            white-space: normal;
        }

        th:nth-child(1), td:nth-child(1) {
            width: 46%;
        }
        
        td:nth-child(1) {
            text-align: left;
            padding-left: 0.5em; /* ì§„ë£Œê³¼ ì™¼ìª½ ì—¬ë°± ì¶”ê°€ ì¶•ì†Œ */
        }

        .dept-cell {
            display: flex;
            align-items: center;
            gap: 0.6em; /* ì¸ë””ì¼€ì´í„°ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
        }

        th:nth-child(2), td:nth-child(2) {
            width: 27%;
        }
        th:nth-child(3), td:nth-child(3) {
            width: 27%;
        }

        th {
            font-family: 'GmarketSansMedium', sans-serif;
            background-color: #495057;
            color: #f8f9fa;
            font-weight: bold;
            font-size: 1.1em;
        }

        .time-slot-box.am th {
            background-color: #0097e6; /* ì˜¤ì „: ë°ì€ íŒŒë€ìƒ‰ */
            color: #212529; /* ê°€ë…ì„±ì„ ìœ„í•´ ì–´ë‘ìš´ ê¸€ììƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }

        .time-slot-box.pm th {
            background-color: #27ae60; /* ì˜¤í›„: ë°ì€ ë…¹ìƒ‰ */
            color: #212529; /* ê°€ë…ì„±ì„ ìœ„í•´ ì–´ë‘ìš´ ê¸€ììƒ‰ìœ¼ë¡œ ë³€ê²½ */
        }

        .header-inactive {
            background-color: #495057 !important;
            color: #adb5bd !important;
        }

        .closed,
        .finished {
            color: #f26d6d; /* ì¡°ê¸ˆ ì—°í•œ ë¶‰ì€ìƒ‰ìœ¼ë¡œ í†µì¼ */
            font-weight: bold;
        }
        .surgery,
        .congestion {
            color: #f0ad4e; /* ì§™ì€ ë…¸ë€ìƒ‰ìœ¼ë¡œ í†µì¼ */
            font-weight: bold;
        }
        .open {
            /* No visible text to style */
            font-weight: bold;
        }

        /* Highlighter effect for doctor's name */
        .highlight-text {
            padding: 0 0.4em; /* ìˆ˜ì§ ì—¬ë°±ì„ ì œê±°í•˜ì—¬ ë°•ìŠ¤ ë†’ì´ ì¡°ì • */
            border-radius: 4px;
            color: #18181b; /* Dark text for contrast on all highlights */
            position: relative; /* ì˜¤ë²„ë ˆì´ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-indexì™€ í•¨ê»˜ ì‚¬ìš© */
            z-index: 2; /* ì˜¤ë²„ë ˆì´(z-index: 1) ìœ„ì— ìœ„ì¹˜í•˜ë„ë¡ ì„¤ì • */
        }
        .highlight-closed,
        .highlight-finished {
            background-color: #f26d6d; /* ì¡°ê¸ˆ ì—°í•œ ë¶‰ì€ìƒ‰ ë°°ê²½ */
        }
        .highlight-surgery,
        .highlight-congestion {
            background-color: #f0ad4e; /* ì§™ì€ ë…¸ë€ìƒ‰ ë°°ê²½ */
        }

        /* Grouping Styles */
        .group-start td, .group-middle td, .group-end td {
            background-color: #3c424a; /* ê·¸ë£¹í™”ëœ í–‰ì˜ ë°°ê²½ìƒ‰ */
        }

        .group-start td {
            border-top: 2px solid #6c757d;
        }
        .group-end td {
            box-shadow: inset 0 -2px 0 #6c757d; /* ë ˆì´ì•„ì›ƒì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ” box-shadowë¡œ ë³€ê²½ */
        }

        /* Overlay effect for inactive rows */
        .row-inactive td {
            position: relative; /* ì˜¤ë²„ë ˆì´ì˜ ìœ„ì¹˜ ê¸°ì¤€ì  ì„¤ì • */
        }

        .row-inactive td::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(52, 58, 64, 0.65); /* ë°˜íˆ¬ëª… íšŒìƒ‰ ë°°ê²½ */
            background-image: repeating-linear-gradient( /* ì‚¬ì„  íŒ¨í„´ */
                -45deg,
                transparent, transparent 15px,
                rgba(0, 0, 0, 0.1) 15px, rgba(0, 0, 0, 0.1) 30px
            );
            z-index: 1; /* í…ìŠ¤íŠ¸ ìœ„ì— ì˜¤ë²„ë ˆì´ê°€ ìœ„ì¹˜í•˜ë„ë¡ ì„¤ì • */
        }

        .title-inactive {
            color: #adb5bd; /* ë¹„í™œì„± ì œëª© ìƒ‰ìƒ */
        }

        .text-inactive {
            color: #adb5bd; /* êº¼ì§„ í•­ëª© í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ë” ë°ê²Œ) */
        }

        /* LED Indicator Styles */
        .led-indicator {
            position: relative; /* ìì‹ ìš”ì†Œì˜ ìœ„ì¹˜ ê¸°ì¤€ */
            display: inline-block;
            width: 3.7vh; /* LED ì¸ë””ì¼€ì´í„° í¬ê¸° ë³µì› */
            height: 3.7vh; /* LED ì¸ë””ì¼€ì´í„° í¬ê¸° ë³µì› */
            margin-right: 0.6em;
            vertical-align: middle; /* í…ìŠ¤íŠ¸ì™€ì˜ ìˆ˜ì§ ì •ë ¬ - flexbox ì‚¬ìš© ì‹œ ëŒ€ì²´ë¨ */
            flex-shrink: 0; /* flex container ë‚´ì—ì„œ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
        }

        /* ì¤‘ì•™ì— ê¹œë¹¡ì´ëŠ” ì  */
        .led-indicator .led-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 65%; /* íƒ€ì´ë¨¸ ë‚´ë¶€ì— ìœ„ì¹˜í•˜ë„ë¡ í¬ê¸° ì¡°ì • */
            height: 65%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.3);
        }

        /* SVG íƒ€ì´ë¨¸ */
        .led-indicator .led-chart {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .led-chart .led-circle-bg {
            fill: none;
            stroke: #4a5c6d;
            stroke-width: 5; /* ê³ ë¦¬ êµµê¸° í‚¤ì›€ */
        }

        .led-chart .led-circle {
            fill: none;
            stroke-width: 5; /* ê³ ë¦¬ êµµê¸° í‚¤ì›€ */
            stroke-linecap: round;
            transform-origin: 50% 50%;
            stroke-dasharray: 30, 100; /* ê³ ì • ìƒ‰ìƒ ì˜ì—­ 30%ë¡œ ëŠ˜ë¦¼ */
        }
        
        /*
        .dept-icon {
            margin-right: 0.4em;
            vertical-align: middle;
        }
        */

        /* ì™¸ê³¼: íŒŒë‘ */
        .led-surg .led-dot {
            background-color: #00BFFF;
            box-shadow: 0 0 8px #00BFFF;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-surg .led-circle {
            stroke: #00BFFF;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* ë‚´ê³¼: ì£¼í™© */
        .led-im .led-dot {
            background-color: #FF6D00;
            box-shadow: 0 0 8px #FF6D00;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-im .led-circle {
            stroke: #FF6D00;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* ê°‘ìƒì„ ìœ ë°©ì„¼í„°: í•«í•‘í¬ */
        .led-thyroid .led-dot {
            background-color: #FF69B4; /* í•«í•‘í¬ */
            box-shadow: 0 0 8px #FF69B4;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-thyroid .led-circle {
            stroke: #FF69B4;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* ì‹ ê²½ì™¸ê³¼: ë…¸ë‘ */
        .led-ns .led-dot {
            background-color: #FFD600;
            box-shadow: 0 0 8px #FFD600;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-ns .led-circle {
            stroke: #FFD600;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* ì •í˜•ì™¸ê³¼: ë…¹ìƒ‰ */
        .led-os .led-dot {
            background-color: #4CAF50;
            box-shadow: 0 0 8px #4CAF50;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-os .led-circle {
            stroke: #4CAF50;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* ì‚°ë¶€ì¸ê³¼: ë¹¨ê°• */
        .led-obgy .led-dot {
            background-color: #FF1744;
            box-shadow: 0 0 8px #FF1744;
            animation: pulse-animation 2.5s infinite linear;
        }
        .led-obgy .led-circle {
            stroke: #FF1744;
            animation: rotate-animation 2.5s linear infinite;
        }

        /* êº¼ì§„ ìƒíƒœ: íšŒìƒ‰ */
        .led-off .led-dot {
            background-color: #495057;
            box-shadow: inset 0 0 4px rgba(0,0,0,0.4);
        }
        .led-off .led-chart {
            display: none; /* êº¼ì§„ ìƒíƒœì—ì„œëŠ” íƒ€ì´ë¨¸ ìˆ¨ê¹€ */
        }

        @keyframes pulse-animation {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }
        
        @keyframes rotate-animation {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .circular-timer {
            width: 4vh;
            height: 4vh;
        }
        .circular-chart {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
        .circular-chart .circle-bg {
            fill: none;
            stroke: #4a5c6d;
            stroke-width: 3.8;
        }
        .circular-chart .circle {
            fill: none;
            stroke: #a3c4ff;
            stroke-width: 2.8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s linear;
        }

        .version-info {
            position: fixed;
            right: 5px;
            bottom: 5px;
            font-size: 0.3em;
            color: #6c757d;
            user-select: none;
        }

        /* í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì»¨íŠ¸ë¡¤ UI */
        #test-mode-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #test-mode-controls select, #test-mode-controls button {
            background-color: #495057;
            color: #f8f9fa;
            border: 1px solid #6c757d;
            border-radius: 4px;
            padding: 0.5vh 1vh;
            font-family: 'S-CoreDream', sans-serif;
            font-size: 2vh;
            cursor: pointer;
        }

        #test-mode-controls button {
            background-color: #e53935; /* ë‹«ê¸° ë²„íŠ¼ ìƒ‰ìƒ */
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="title-box">
        <div class="title-group">
            <img id="logo" src="kooh_logo.png" alt="ë³‘ì› ë¡œê³ " onerror="this.src='/kooh_logo.png'; this.onerror=function(){this.style.display='none'};">
            <h1 class="main-title">êµ¬ë³‘ì› ì§„ë£Œ ìŠ¤ì¼€ì¤„</h1>
            <p class="current-date"></p>
        </div>
        <div id="test-mode-controls" style="display: none;">
            <select id="test-day-select"></select>
            <select id="test-ampm-select">
                <option value="am">ì˜¤ì „</option>
                <option value="pm">ì˜¤í›„</option>
            </select>
            <button id="test-mode-close-btn">ë‹«ê¸°</button>
        </div>
        <div id="refresh-timer" class="circular-timer">
            <svg viewBox="0 0 36 36" class="circular-chart">
                <path class="circle-bg"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                />
                <path class="circle"
                    stroke-dasharray="100, 100"
                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                />
            </svg>
        </div>
    </div>
    
    <div class="schedule-container">
        <!-- ì˜¤ì „ ì§„ë£Œ -->
        <div class="time-slot-box am">
            <div class="finished-overlay"><span>ì˜¤ì „ ì§„ë£Œ ë§ˆê°</span></div>
            <h2 class="schedule-section-title">ì˜¤ì „ ì§„ë£Œ</h2>
            <table>
                <thead>
                    <tr>
                        <th>ì§„ë£Œê³¼</th>
                        <th>ì§„ë£Œì˜ì‚¬</th>
                        <th>ë¹„ê³ </th>
                    </tr>
                </thead>
                <tbody id="am-schedule-body"></tbody>
            </table>
        </div>

        <!-- ì˜¤í›„ ì§„ë£Œ -->
        <div class="time-slot-box pm">
            <h2 class="schedule-section-title">ì˜¤í›„ ì§„ë£Œ</h2>
            <table>
                <thead>
                    <tr>
                        <th>ì§„ë£Œê³¼</th>
                        <th>ì§„ë£Œì˜ì‚¬</th>
                        <th>ë¹„ê³ </th>
                    </tr>
                </thead>
                <tbody id="pm-schedule-body"></tbody>
            </table>
        </div>
    </div>

    <p class="version-info">v.20250813-010</p>

    <script>
        const sheetId = '1m0kCyq3QI9e203Rkhh0_gTFD6Jdafn89p3-AbddZ2OU';
        const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        const REFRESH_INTERVAL = 30000; // 30ì´ˆ

        const gidMap = {
            'ì¼': '1340551526',
            'ì›”': '166831320',
            'í™”': '1050890560',
            'ìˆ˜': '675567842',
            'ëª©': '1074220298',
            'ê¸ˆ': '1055010041',
            'í† ': '944320917',
        };

        let isTestMode = false;
        let testModeDay = null;
        let testModeIsAfternoon = null;
        let refreshIntervalId = null;

        /*
        const departmentIcons = {
            'ì™¸ê³¼': 'âš•ï¸',
            'ë‚´ê³¼': 'ğŸ©º',
            'ê°‘ìƒì„ ìœ ë°©ì„¼í„°': 'ğŸ€',
            'ì‹ ê²½ì™¸ê³¼': 'ğŸ§ ',
            'ì •í˜•ì™¸ê³¼': 'ğŸ¦¾',
            'ì‚°ë¶€ì¸ê³¼': 'ğŸ¤°'
        };
        */

        const getDepartment = (row, index) => {
            if (!row || !row.c[index]) return '';
            let department = row.c[index].v;
            if (department.includes(':')) {
                department = department.split(':')[1].trim();
            }
            return department;
        };

        function restartCircularTimerAnimation(circleElement, interval) {
            if (!circleElement) return;
            // ì• ë‹ˆë©”ì´ì…˜ ë¦¬ì…‹
            circleElement.style.transition = 'none';
            circleElement.style.strokeDashoffset = '100';
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘ (setTimeoutìœ¼ë¡œ ë¸Œë¼ìš°ì €ê°€ ë¦¬ì…‹ì„ ì¸ì§€í•  ì‹œê°„ì„ ì¤Œ)
            setTimeout(() => {
                circleElement.style.transition = `stroke-dashoffset ${interval / 1000}s linear`;
                circleElement.style.strokeDashoffset = '0';
            }, 50);
        }

        function checkSessionStatus(isAfternoon) {
            const amOverlay = document.querySelector('.time-slot-box.am .finished-overlay');
            if (isAfternoon) { 
                amOverlay.style.display = 'flex';
            } else {
                amOverlay.style.display = 'none';
            }
        }

        function fetchSchedule() {
            if (!isTestMode) {
                const refreshTimerCircle = document.querySelector('#refresh-timer .circle');
                restartCircularTimerAnimation(refreshTimerCircle, REFRESH_INTERVAL);
            }

            let dayOfWeek, isAfternoon, displayDayName;
            const dateContainer = document.querySelector('.current-date');

            if (isTestMode) {
                dayOfWeek = testModeDay;
                isAfternoon = testModeIsAfternoon;
                displayDayName = dayOfWeek;
                dateContainer.textContent = `(í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ${displayDayName}ìš”ì¼)`;
            } else {
                const today = new Date();
                const year = today.getFullYear();
                const month = today.getMonth() + 1;
                const day = today.getDate();
                dayOfWeek = dayNames[today.getDay()];
                displayDayName = dayOfWeek;
                dateContainer.textContent = `(${year}ë…„ ${month}ì›” ${day}ì¼ ${displayDayName}ìš”ì¼)`;

                const dayIndex = today.getDay();
                const currentHour = today.getHours();
                const currentMinute = today.getMinutes();
                isAfternoon = (dayIndex === 0 || dayIndex === 6) ? currentHour >= 13 : (currentHour > 12 || (currentHour === 12 && currentMinute >= 30));
            }

            checkSessionStatus(isAfternoon);

            const amTitle = document.querySelector('.time-slot-box.am .schedule-section-title');
            const pmTitle = document.querySelector('.time-slot-box.pm .schedule-section-title');
            const amHeaders = document.querySelectorAll('.time-slot-box.am th');
            const pmHeaders = document.querySelectorAll('.time-slot-box.pm th');

            if (isAfternoon) {
                // ì˜¤í›„ì¼ ë•Œ: ì˜¤ì „ ì œëª©ê³¼ í—¤ë”ë¥¼ ë¹„í™œì„±í™”
                amTitle.classList.add('title-inactive');
                amHeaders.forEach(th => th.classList.add('header-inactive'));

                pmTitle.classList.remove('title-inactive');
                pmHeaders.forEach(th => th.classList.remove('header-inactive'));
            } else {
                // ì˜¤ì „ì¼ ë•Œ: ì˜¤í›„ ì œëª©ê³¼ í—¤ë”ë¥¼ ë¹„í™œì„±í™”
                amTitle.classList.remove('title-inactive');
                amHeaders.forEach(th => th.classList.remove('header-inactive'));

                pmTitle.classList.add('title-inactive');
                pmHeaders.forEach(th => th.classList.add('header-inactive'));
            }

            const currentGid = gidMap[dayOfWeek];
            
            if (!currentGid) {
                console.error(`Error: Gid for ${dayOfWeek} not found.`);
                return;
            }

            const apiUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?gid=${currentGid}&tqx=out:json`;
            
            fetch(apiUrl)
                .then(res => {
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }
                    return res.text();
                })
                .then(text => {
                    const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]+)\)/);
                    if (!match || !match[1]) {
                        throw new Error('Google Sheet ì‘ë‹µ í˜•ì‹ì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                    const jsonText = match[1];
                    const json = JSON.parse(jsonText);

                    const table = json.table;
                    const rawRows = table.rows;

                    const headers = rawRows[0].c.map(header => (header ? header.v : ''));

                    const ampmIndex = headers.indexOf('ì˜¤ì „/ì˜¤í›„');
                    const departmentIndex = headers.indexOf('ì§„ë£Œê³¼');
                    const doctorIndex = headers.indexOf('ì§„ë£Œì˜ì‚¬');
                    const statusIndex = headers.indexOf('ë¹„ê³ ');

                    if ([ampmIndex, departmentIndex, doctorIndex, statusIndex].includes(-1)) {
                        console.error('Error: Required column headers not found.');
                        return;
                    }

                    const amRows = [];
                    const pmRows = [];

                    for (let i = 1; i < rawRows.length; i++) {
                        const row = rawRows[i];
                        const ampm = row.c[ampmIndex] ? row.c[ampmIndex].v : '';
                        if (ampm === 'ì˜¤ì „') {
                            amRows.push(row);
                        } else if (ampm === 'ì˜¤í›„') {
                            pmRows.push(row);
                        }
                    }

                    const renderGroupedRows = (tbody, dataRows, sessionType) => {
                        const isSessionActive = (sessionType === 'am' && !isAfternoon) || (sessionType === 'pm' && isAfternoon);

                        tbody.innerHTML = '';
                        for (let i = 0; i < dataRows.length; i++) {
                            const currentRow = dataRows[i];
                            const prevRow = dataRows[i - 1];
                            const nextRow = dataRows[i + 1];

                            const currentDept = getDepartment(currentRow, departmentIndex);
                            const prevDept = getDepartment(prevRow, departmentIndex);
                            const nextDept = getDepartment(nextRow, departmentIndex);

                            let groupClass = '';
                            if (currentDept !== prevDept) {
                                groupClass += 'group-start ';
                            }
                            if (currentDept !== nextDept) {
                                groupClass += 'group-end ';
                            }
                            if (currentDept === prevDept && currentDept === nextDept) {
                                groupClass += 'group-middle ';
                            }

                            const doctor = currentRow.c[doctorIndex] ? currentRow.c[doctorIndex].v : '';
                            const status = currentRow.c[statusIndex] ? currentRow.c[statusIndex].v : '';

                            const ledColorMap = {
                                'ì™¸ê³¼': 'led-surg',
                                'ë‚´ê³¼': 'led-im',
                                'ê°‘ìƒì„ ìœ ë°©ì„¼í„°': 'led-thyroid',
                                'ì‹ ê²½ì™¸ê³¼': 'led-ns',
                                'ì •í˜•ì™¸ê³¼': 'led-os',
                                'ì‚°ë¶€ì¸ê³¼': 'led-obgy'
                            };
                            const isDoctorInactive = status === 'íœ´ì§„' || status === 'ë§ˆê°';
                            const isLedOff = isDoctorInactive || !isSessionActive;
                            const ledColorClass = ledColorMap[currentDept] || 'led-off';
                            const ledClass = isLedOff ? 'led-off' : ledColorClass;
                            const ledIndicator = `
                                <div class="led-indicator ${ledClass}">
                                    <div class="led-dot"></div>
                                    <svg viewBox="0 0 36 36" class="led-chart">
                                        <path class="led-circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                        <path class="led-circle" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    </svg>
                                </div>
                            `;
                            // const icon = departmentIcons[currentDept] ? `<span class="dept-icon">${departmentIcons[currentDept]}</span>` : '';

                            let statusClass = '';
                            if (status === 'íœ´ì§„') statusClass = 'closed';
                            else if (status === 'ìˆ˜ìˆ ì¤‘') statusClass = 'surgery';
                            else if (status === 'ë§ˆê°') statusClass = 'finished';
                            else if (status === 'ëŒ€ê¸°í˜¼ì¡') statusClass = 'congestion';
                            else if (status === 'O') statusClass = 'open';
                            
                            const cellContent = status === 'O' ? '' : status;
                            let statusCellContent = cellContent;
                            if (statusClass && statusClass !== 'open') {
                                const highlightColorClass = `highlight-${statusClass}`;
                                statusCellContent = `<span class="highlight-text ${highlightColorClass}">${cellContent}</span>`;
                            }

                            const textInactiveClass = isLedOff ? 'text-inactive' : '';

                            const tr = document.createElement('tr');
                            tr.className = groupClass.trim();

                            if (isDoctorInactive) {
                                tr.classList.add('row-inactive');
                            }
                            
                            tr.innerHTML = `
                                <td class="${textInactiveClass}">
                                    <div class="dept-cell">${ledIndicator}<span>${currentDept}</span></div>
                                </td>
                                <td class="${textInactiveClass}">${doctor}</td>
                                <td class="${statusClass}">${statusCellContent}</td>
                            `;
                            tbody.appendChild(tr);
                        }
                    };

                    const amScheduleBody = document.querySelector('#am-schedule-body');
                    const pmScheduleBody = document.querySelector('#pm-schedule-body');
                    renderGroupedRows(amScheduleBody, amRows, 'am');
                    renderGroupedRows(pmScheduleBody, pmRows, 'pm');
                })
                .catch(e => {
                    console.error('Fetch error:', e);
                    const amScheduleBody = document.querySelector('#am-schedule-body');
                    const pmScheduleBody = document.querySelector('#pm-schedule-body');
                    const errorMessage = `ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” ë°ì´í„° ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”. (ì˜¤ë¥˜: ${e.message})`;
                    amScheduleBody.innerHTML = `<tr><td colspan="3" style="color: red; white-space: normal;">${errorMessage}</td></tr>`;
                    pmScheduleBody.innerHTML = '';
                });
        }

        // í…ŒìŠ¤íŠ¸ ëª¨ë“œ í™œì„±í™”
        document.querySelector('.title-box').addEventListener('click', (e) => {
            // ì»¨íŠ¸ë¡¤ UIë‚˜ ê·¸ ìì‹ ìš”ì†Œë¥¼ í´ë¦­í–ˆê±°ë‚˜, ì´ë¯¸ í…ŒìŠ¤íŠ¸ ëª¨ë“œì¼ ê²½ìš° ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
            if (e.target.closest('#test-mode-controls') || isTestMode) {
                return;
            }

            isTestMode = true;
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
            }

            document.getElementById('test-mode-controls').style.display = 'flex';
            document.getElementById('refresh-timer').style.display = 'none';

            const daySelect = document.getElementById('test-day-select');
            daySelect.innerHTML = '';
            dayNames.forEach(day => {
                const option = document.createElement('option');
                option.value = day;
                option.textContent = day;
                daySelect.appendChild(option);
            });

            const today = new Date();
            const currentDayName = dayNames[today.getDay()];
            const currentHour = today.getHours();
            const currentMinute = today.getMinutes();
            const dayIndex = today.getDay();
            const isCurrentAfternoon = (dayIndex === 0 || dayIndex === 6) ? currentHour >= 13 : (currentHour > 12 || (currentHour === 12 && currentMinute >= 30));

            daySelect.value = currentDayName;
            document.getElementById('test-ampm-select').value = isCurrentAfternoon ? 'pm' : 'am';

            testModeDay = currentDayName;
            testModeIsAfternoon = isCurrentAfternoon;

            fetchSchedule();
        });

        // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ë¹„í™œì„±í™”
        document.getElementById('test-mode-close-btn').addEventListener('click', () => {
            isTestMode = false;
            testModeDay = null;
            testModeIsAfternoon = null;

            document.getElementById('test-mode-controls').style.display = 'none';
            document.getElementById('refresh-timer').style.display = 'block';

            fetchSchedule();
            if (!refreshIntervalId) {
                refreshIntervalId = setInterval(fetchSchedule, REFRESH_INTERVAL);
            }
        });

        // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì»¨íŠ¸ë¡¤ëŸ¬ ë³€ê²½ ì´ë²¤íŠ¸
        document.getElementById('test-day-select').addEventListener('change', (e) => {
            testModeDay = e.target.value;
            fetchSchedule();
        });
        document.getElementById('test-ampm-select').addEventListener('change', (e) => {
            testModeIsAfternoon = (e.target.value === 'pm');
            fetchSchedule();
        });


        // ì´ˆê¸° ì‹¤í–‰
        fetchSchedule();
        refreshIntervalId = setInterval(fetchSchedule, REFRESH_INTERVAL);
    </script>
</body>
</html>
